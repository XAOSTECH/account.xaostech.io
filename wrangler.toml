name = "xaostech-account"
compatibility_date = "2025-12-31"
main = "src/index.ts"
send_metrics = false
compatibility_flags = ["nodejs_compat"]

[env.production]
name = "xaostech-account"
main = "src/index.ts"
routes = [{ pattern = "account.xaostech.io/*", zone_name = "xaostech.io" }]

# Runtime secrets for OAuth (set via wrangler secret put --env production)
# GITHUB_CLIENT_ID, GITHUB_CLIENT_SECRET

[env.production.vars]
OAUTH_PROVIDER = "github"
COOKIE_DOMAIN = ".xaostech.io"
COOKIE_SECURE = "true"
COOKIE_HTTP_ONLY = "true"
COOKIE_SAME_SITE = "Lax"
SESSION_TTL = "604800"

[[env.production.kv_namespaces]]
binding = "SESSIONS_KV"
id = "${KV_SESSIONS_ID}"

[[env.production.d1_databases]]
binding = "DB"
database_name = "account-db"
database_id = "${D1_ACCOUNT_DB_ID}"

[env.testing]
routes = [{ pattern = "account.testing.local/*", zone_name = "localhost" }]

[env.testing.vars]
OAUTH_PROVIDER = "github"
COOKIE_DOMAIN = ".testing.local"
COOKIE_SECURE = "false"
COOKIE_HTTP_ONLY = "true"
COOKIE_SAME_SITE = "Lax"
SESSION_TTL = "604800"
